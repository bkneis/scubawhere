function getToken(a){return"string"==typeof window.token&&window.token.length>0?("function"==typeof a&&a(window.token),window.token):(tokenRequestCallbacks.push(a),tokenRequestUnderway?!1:(window.tokenRequestUnderway=!0,$.ajax({url:"/api/token",type:"GET",success:function(a){window.token=a,window.tokenRequestUnderway=!1;for(var b=0;b<tokenRequestCallbacks.length;b++)"function"==typeof tokenRequestCallbacks[b]&&tokenRequestCallbacks[b](window.token)}}),!1))}function setToken(a){getToken(function(b){$(a).val(b)})}function reproColor(a){var b=[{bgcolor:"#001F3F",txtcolor:"#FFFFFF"},{bgcolor:"#0074D9",txtcolor:"#FFFFFF"},{bgcolor:"#7FDBFF",txtcolor:"#000000"},{bgcolor:"#39CCCC",txtcolor:"#000000"},{bgcolor:"#3D9970",txtcolor:"#000000"},{bgcolor:"#2ECC40",txtcolor:"#000000"},{bgcolor:"#01FF70",txtcolor:"#000000"},{bgcolor:"#FFDC00",txtcolor:"#000000"},{bgcolor:"#FF851B",txtcolor:"#000000"},{bgcolor:"#FF4136",txtcolor:"#FFFFFF"},{bgcolor:"#85144B",txtcolor:"#FFFFFF"},{bgcolor:"#F012BE",txtcolor:"#FFFFFF"},{bgcolor:"#B10DC9",txtcolor:"#FFFFFF"},{bgcolor:"#DDDDDD",txtcolor:"#000000"}],c=b.length;return void 0===a?b[0]:b[a%c]}function createNotifications(a){var b=[];a.init&&b.push(a.init);for(var c=0;c<a.overdue.length;c++)b.push("Booking "+a.overdue[c][0]+" has "+window.company.currency.symbol+a.overdue[c][1]+" outstanding to pay");for(var c=0;c<a.expiring.length;c++)b.push("Booking "+a.expiring[c][0]+" is going to expire soon!");return b}function colorOpacity(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||1;var c,d,e="rgba(";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),e+=c+", ";return e+=b+")"}function randomString(){for(var a="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",b=15,c="",d=0;b>d;d++){var e=Math.floor(Math.random()*a.length);c+=a.substring(e,e+1)}return _.indexOf(window.sw.randomStrings,c)>=0?randomString():(window.sw.randomStrings.push(c),c)}function decRound(a,b){return 1>b?Math.round(a):Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function initPriceDatepickers(){$("input.datepicker").not(".datepicker-initiated").addClass("datepicker-initiated").datetimepicker({pickDate:!0,pickTime:!1,icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down"}})}function checkDefaultSwitches(){if(alert('If you see this alert, please contact Soren with the following message: "Tombstone 001 found"'),$(".option-active").length>0){var a=$(".option-active");a.each(function(){var a="#"+$(this).parent().attr("for"),b=$(this).attr("id");$(a).html(LOADER).load(b)})}}function pageMssg(a,b,c){"undefined"==typeof b&&(b="danger"),"boolean"==typeof b&&(b="success"),"undefined"==typeof c&&(c=!1);var d='<div class="findMe alert alert-'+b+" border-"+b+(c?" alert-dismissable":"")+'" role="alert">';switch(c&&(d+='<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>'),b){case"success":d+='<i class="fa fa-check fa-lg fa-fw"></i> ';break;case"info":d+='<i class="fa fa-info fa-lg fa-fw"></i> ';break;case"warning":d+='<i class="fa fa-exclamation fa-lg fa-fw"></i> ';break;case"danger":d+='<i class="fa fa-times fa-lg fa-fw"></i> '}d+=a,d+="</div>",$("#pageMssg").append(d).find(".findMe").removeClass("findMe").fadeIn(400,function(){if(!$(this).hasClass("alert-dismissable")){var a=this;setTimeout(function(){$(a).fadeOut(400,function(){$(this).remove()})},3e3)}})}Date.now||(Date.now=function(){return(new Date).getTime()}),$.ajaxSetup({beforeSend:function(a,b){"/api"===b.url.substr(0,4)&&"POST"!==b.type&&$.extend(this,{url:b.url+(-1===b.url.indexOf("?")?"?_=":"&_=")+Date.now(),cache:!1}),b.url.indexOf("index.php")>-1&&NProgress.start(),b.url.indexOf("help/index.php")>-1&&$.extend(this,{complete:function(){NProgress.done()}})}}),window.setInterval(function(){Company.sendHeartbeat({h:1})},6e4),$(function(){$(document).ajaxComplete(function(a,b,c){b.status>=400,503===b.status&&pageMssg("<strong>The application is in maintenance mode.</strong> Please check back in a few minutes.","warning")}),$(document).ajaxStart(function(){NProgress.start();var a=400+400*Math.random();window.sw.nProgressInterval=window.setInterval(function(){NProgress.inc()},a)}),$(document).ajaxStop(function(){window.clearInterval(window.sw.nProgressInterval),NProgress.done()}),Company.getNotifications(function(a){var b=Handlebars.compile($("#notification-message-template").html());window.notifications=createNotifications(a),$("#notification-messages").append(b({notifications:window.notifications}))}),$(".notifications .messages").hide(),$(".notifications").click(function(){$(this).children(".messages").children().length>0&&$(this).children(".messages").fadeToggle(300)}),$("#logout").click(function(a){$.ajax({url:"/api/logout",type:"GET",dataType:"json",success:function(a){location="/",window.location.href=location}}),a.preventDefault()}),"undefined"==typeof window.token&&getToken()});var tokenRequestUnderway=!1,tokenRequestCallbacks=[];window.sw.randomStrings=[],Handlebars.registerHelper("ifCond",function(a,b,c,d){switch(b){case"==":return a==c?d.fn(this):d.inverse(this);case"!=":return a!=c?d.fn(this):d.inverse(this);case"===":return a===c?d.fn(this):d.inverse(this);case"!==":return a!==c?d.fn(this):d.inverse(this);case"<":return c>a?d.fn(this):d.inverse(this);case"<=":return c>=a?d.fn(this):d.inverse(this);case">":return a>c?d.fn(this):d.inverse(this);case">=":return a>=c?d.fn(this):d.inverse(this);case"&&":return a&&c?d.fn(this):d.inverse(this);case"||":return a||c?d.fn(this):d.inverse(this);default:return d.inverse(this)}}),Handlebars.registerHelper("unlessCond",function(a,b,c,d){switch(b){case"==":return a==c?d.inverse(this):d.fn(this);case"===":return a===c?d.inverse(this):d.fn(this);case"<":return c>a?d.inverse(this):d.fn(this);case"<=":return c>=a?d.inverse(this):d.fn(this);case">":return a>c?d.inverse(this):d.fn(this);case">=":return a>=c?d.inverse(this):d.fn(this);case"&&":return a&&c?d.inverse(this):d.fn(this);case"||":return a||c?d.inverse(this):d.fn(this);default:return d.inverse(this)}}),$(function(){var a="",b=$("#content");$("#page-wrap");$(window).on("hashchange",function(){if(a=window.location.hash.substring(1),""===a)return void(window.location.hash="dashboard");var c=$.Deferred(),d="tabs/"+a+"/index.php";$.ajax({url:d,type:"GET",global:!1,success:function(a){c.resolve(a)}}),$(".tab-active").removeClass("tab-active"),$('#sidenav a[href="#'+a+'"]').parent().addClass("tab-active");var e=["calendar","scheduling","pickup-schedule"],f=["accommodations","add-ons","agents","classes","courses","boats","locations","packages","activate-trip","tickets","trips"];-1!==e.indexOf(a)&&$("#calendar-submenu").css("display","block"),-1!==f.indexOf(a)&&$("#management-submenu").css("display","block"),b.find("#wrapper").fadeOut(200,function(){$("#wrapper").remove(),"pending"===c.state()&&b.html(LOADER),c.done(function(a){b.html(a)})});var g=$('#sidenav a[href="#'+a+'"]').text();"add-transaction"===a&&(g='<a href="#manage-bookings">Manage Bookings</a> <small><i class="fa fa-chevron-right fa-fw text-muted"></i></small> Add Transaction'),$("#breadcrumbs").html('<a href="#dashboard" class="breadcrumbs-home"><i class="fa fa-home fa-lg fa-fw"></i></a> <small><i class="fa fa-chevron-right fa-fw text-muted"></i></small> '+g),window.scrollTo(0,0),getToken(function(){Company.sendHeartbeat({n:1})})}),$(window).trigger("hashchange")}),$(function(){$("#sidenav > li > div").click(function(){$(this).parent().children().is(":hidden")?($($(this).parent().children("ul")).slideDown("fast"),$($(this).children(".caret")).css("transform","rotate(0deg)")):($($(this).parent().children("ul")).slideUp("fast"),$($(this).children(".caret")).css("transform","rotate(-90deg)"))})});var Tour={getAcommodationsTour:function(){window.tourStart&&($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"accommodation-form-container":$("#room-name").val("3* Hotel Single Room"),$("#acom-price").val(50);break;case"acom-base":$("#add-base-price").click(),$("#acom-price").val(50);break;case"acom-season":$("#acom-season-price").click(),$("#acom-price").val(50);break;case"acom-rooms":$("#room-amount").val(6);break;case"accommodations-list":$("#no-accommodations").remove(),$("#accommodation-list").append('<li id="dummy-room"><strong>3* Hotel Single Room</strong> | 6 | 50</li>')}}).oncomplete(function(){$("#dummy-room").remove(),$("#accommodation-list").append('<p id="no-accommodations">No accommodations available.</p>'),clearForm()}),$("#tour-next-step").on("click",function(){window.location.href="#agents",window.currentStep.position<=1&&(window.currentStep={tab:"#agents",position:2}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#agent-tab").addClass("selected")}))},getAgentsTour:function(){window.tourStart&&(window.currentStep.position<2?window.location.href=window.currentStep.tab:($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"agent-form-container":$("#agent-name").val("John doe"),$("#agent-web").val("http://www.onlinescubaholidays.com"),$("#branch-name").val("Scuba holidays R us"),$("#branch-address").val("46 grand avenue tenerife"),$("#branch-phone").val("+44 7866565047"),$("#branch-email").val("john.doe@scubaholidays.com");break;case"commission-div":$("#commission-amount").val(20);break;case"agent-list-div":$("#no-agents").remove(),$("#agent-list").append('<li id="dummy-agent"><strong>John doe</strong> | Scuba holidays r us</li>')}}).oncomplete(function(){$("#dummy-agent").remove(),$("#agent-list").append('<p id="no-agents">No agents available.</p>'),clearForm()})),$("#tour-next-step").on("click",function(){window.location.href="#locations",window.currentStep.position<=2&&(window.currentStep={tab:"#locations",position:3}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#location-tab").addClass("selected")}))},getLocationsTour:function(){window.tourStart&&(window.currentStep.position<3?window.location.href=window.currentStep.tab:($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start()),$("#tour-next-step").on("click",function(){window.location.href="#boats",window.currentStep.position<=3&&(window.currentStep={tab:"#boats",position:4}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#boat-tab").addClass("selected")}))},getBoatsTour:function(){window.tourStart&&(window.currentStep.position<4?window.location.href=window.currentStep.tab:($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"change-to-add-boatroom":$("#boatroom-list").append('<li id="dummy-boatroom"><strong>Single Cabin</strong></li>');break;case"boat-form-container":$("#boat-name").val("Barry's big boat"),$("#boat-capacity").val(25);break;case"boat-cabins":$("#room-types").append('<p id="cabin-option"> 			        		<select class="room-type-select"> 			        		<option value="{{id}}">Single Cabin</option> 			        		</select> Number of rooms: 			        		<input type="number" value="6" placeholder="0" style="width: 100px;" min="0"> 			        		<button class="btn btn-danger remove-room">&#215;</button> 			        		</p>');break;case"boats-list-div":$("#no-boats").remove(),$("#cabin-option").remove(),$("#boat-list").append('<li id="dummy-boat"><strong>Barrys big boat</strong> | Capacity: 25</li>')}}).oncomplete(function(){$("#dummy-boat").remove(),$("#boat-list").append('<p id="no-boats">No boats available.</p>'),clearForm()})),$("#tour-next-step").on("click",function(){0!=window.boats.length?(window.location.href="#trips",window.currentStep.position<=4&&(window.currentStep={tab:"#trips",position:5}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#trip-tab").addClass("selected")):alert("You need to add atleast one boat")}))},getTripsTour:function(){window.tourStart&&(window.currentStep.position<5?window.location.href=window.currentStep.tab:($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"trip-form-container":$("#trip-name").val("Single boat dive"),$("#tripDuration").val(4);break;case"locationsList":$("#locationsList").find(".location").filter(":first").click();break;case"tagsList":$("#tagsList").find(".tag").filter(":first").click();break;case"trips-list-div":$("#no-trips").remove(),$("#trip-list").append('<li id="dummy-trip"><strong>Single boat dive</strong> | 0d 4h </li>')}}).oncomplete(function(){$("#dummy-trip").remove(),$("#trip-list").append('<p id="no-trips">No trips available.</p>'),clearForm()})),$("#tour-next-step").on("click",function(){0!=window.trips.length?(window.location.href="#tickets",window.currentStep.position<=5&&(window.currentStep={tab:"#tickets",position:6}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#ticket-tab").addClass("selected")):alert("You need to add atleast one ticket")}))},getTicketsTour:function(){window.tourStart&&(window.currentStep.position<6?window.location.href=window.currentStep.tab:($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"ticket-form-container":$("#ticket-name").val("2 dive boat trip"),$("#ticket-base").val(50);break;case"tickets-seasonal":$("#seasonal-prices-checkbox").click();break;case"tickets-boats":$("#tickets-boats-checkbox").click();break;case"tickets-boatrooms":$("#tickets-boatroom-checkbox").click();break;case"tickets-list-div":$("#no-tickets").remove(),$("#ticket-list").append('<li id="dummy-ticket"><strong>New diving trip</strong> | £50.00 </li>')}}).oncomplete(function(){$("#dummy-ticket").remove(),$("#ticket-list").append('<p id="no-tickets">No tickets available.</p>'),clearForm()})),$("#tour-next-step").on("click",function(){0!=window.tickets.length?(window.location.href="#classes",window.currentStep.position<=6&&(window.currentStep={tab:"#classes",position:7}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#class-tab").addClass("selected")):pageMssg("Please add atleast one ticket")}))},getClassesTour:function(){window.tourStart&&(window.currentStep.position<7?window.location.href=window.currentStep.tab:($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"class-form-container":$("#class-name").val("Open Water Theory"),$("#trip-duration").val(5);break;case"class-list-div":$("#no-classes").remove(),$("#class-list").append('<li id="dummy-class"><strong>Open Water Theory</strong> | £10.00 </li>')}}).oncomplete(function(){$("#dummy-class").remove(),$("#class-list").append('<p id="no-classes">No classes available.</p>'),clearForm()})),$("#tour-next-step").on("click",function(){window.location.href="#courses",window.currentStep.position<=7&&(window.currentStep={tab:"#courses",position:8}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#course-tab").addClass("selected")}))},getCoursesTour:function(){window.tourStart&&(window.currentStep.position<8?window.location.href=window.currentStep.tab:($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"course-form-container":$("#course-name").val("PADI open water"),$("#course-capacity").val(10);break;case"course-list-div":$("#no-courses").remove(),$("#course-list").append('<li id="dummy-course"><strong>PADI open water</strong> | £10.00 </li>')}}).oncomplete(function(){$("#dummy-course").remove(),clearForm()})),$("#tour-next-step").on("click",function(){window.location.href="#add-ons",window.currentStep.position<=8&&(window.currentStep={tab:"#add-ons",position:9}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#addon-tab").addClass("selected")}))},getAddonsTour:function(){window.tourStart&&($("#tour-next-step").hide(),$("#tour-finish").show(),window.currentStep.position<9?window.location.href=window.currentStep.tab:($("#tour-next-step").show(),$("#tour-finish").hide(),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"addon-form-container":$("#addon-name").val("Reef diving tax"),$("#addon-price").val(10);break;case"addon-compulsory-div":$("#addon-compulsory").attr("checked",!0);break;case"addon-list-div":$("#no-addons").remove(),$("#addon-list").append('<li id="dummy-addon"><strong>Reef diving tax</strong> | £10.00 </li>')}}).oncomplete(function(){$("#dummy-addon").remove(),$("#addon-list").append('<p id="no-addons">No addons available.</p>'),clearForm()})),$("#tour-next-step").on("click",function(){window.location.href="#packages",window.currentStep.position<=9&&(window.currentStep={tab:"#packages",position:10}),$(".nav-wizard a").filter(".selected").first().addClass("done").removeClass("selected"),$("#package-tab").addClass("selected")}))},getPackagesTour:function(){window.tourStart&&(window.currentStep.position<10?(window.location.href=window.currentStep.tab,console.log(window.currentStep.tab)):($("#tour-button").empty(),$("#tour-button").append('<button id="tour-finish" class="btn btn-success text-uppercase">Finish tour</button>'),introJs().setOptions({showStepNumbers:!1,exitOnOverlayClick:!1,exitOnEsc:!1}).start().onchange(function(a){switch(a.id){case"package-form-container":$("#package-name").val("Family dive day");break;case"package-tickets":$("#package-tickets").find(".ticket-select").filter(":first").val(1),$("#package-tickets").find(".quantity-input").filter(":first").val(4);break;case"package-base":$("#package-base").find(".base-price").filter(":first").val(150);break;case"package-seasonal":$("#package-seasonal").find("input[type=checkbox]").filter(":first").click();break;case"package-size":$("#package-capacity").val(4);break;case"packages-list-div":$("#no-packages").remove(),$("#package-list").append('<li id="dummy-package"><strong>Family dive day</strong> | £150.00 </li>')}}).oncomplete(function(){$("#dummy-package").remove(),$("#package-list").append('<p id="no-packages">No packages available.</p>'),clearForm()})),$("#tour-finish").click(function(a){var b={_token:window.token};Company.initialise(b,function(a){$("#addon-tab").addClass("done"),pageMssg("Thank you for following our wizard. Your system is now fully configured.",!0),setTimeout(function(){window.location.href="#dashboard",window.location.reload(!0)},3e3)})}))}},LOADER='<div class="loader" style="left: 50%; margin-left: -13px; margin-top: 10em;"></div>';$(function(){$("#guts").delegate(".switch-option","click",function(){alert('If you see this alert, please contact Soren with the following message: "Tombstone 005 found"'),$(".switch-option").removeClass("option-active"),$(this).addClass("option-active");var a="#"+$(this).parent().attr("for"),b=$(this).attr("id");$(a).html(LOADER).load(b)}),$("body").on("focus","[data-tooltip]",function(){alert('If you see this alert, please contact Soren with the following message: "Tombstone 006 found"');var a=$("[data-tooltip]").attr("data-tooltip");$(".tooltip").remove(),$("[data-tooltip]").parent().append("<div class='tooltip'>"+a+"</div>"),$(".tooltip").fadeIn("slow");var b=$("[data-tooltip]").offset(),c=$(".tooltip").height();$(".tooltip").offset({top:b.top-40-c,left:b.left})}),$("body").on("focusout","[data-tooltip]",function(){alert('If you see this alert, please contact Soren with the following message: "Tombstone 007 found"'),$(".tooltip").fadeOut("slow")}),$("input.datetimepicker").datetimepicker({pickDate:!0,pickTime:!0,minuteStepping:5,icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down"}}),$("input.datepicker").datetimepicker({pickDate:!0,pickTime:!1,icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down"}}),$("input.timepicker").datetimepicker({pickDate:!1,pickTime:!0,minuteStepping:5,icons:{time:"fa fa-clock-o",date:"fa fa-calendar",up:"fa fa-chevron-up",down:"fa fa-chevron-down"}}),$("body").delegate(".expand-box-arrow","click",function(){alert('If you see this alert, please contact Soren with the following message: "Tombstone 008 found"'),$(this).parent().parent().children(".expandable").slideToggle(),$(this).toggleClass("rotate")}),$("body").delegate(".del-box","click",function(){alert('If you see this alert, please contact Soren with the following message: "Tombstone 009 found"'),$(this).isSure()&&$(this).parent().parent().smoothRemove(function(){$("#saveAll").click()})})}),$.fn.isSure=function(){alert('If you see this alert, please contact Soren with the following message: "Tombstone 002 found"');var a=!0;return $(this).attr("data-sure")&&(a=confirm($(this).attr("data-sure"))),a},$.fn.smoothRemove=function(a){alert('If you see this alert, please contact Soren with the following message: "Tombstone 003 found"'),$(this).animate({height:0,opacity:0},"slow",function(){$(this).remove(),void 0!==a&&"function"==typeof a&&a()})},$.fn.errorMssg=function(a){alert('If you see this alert, please contact Soren with the following message: "Tombstone 004 found"'),$(this).after("<div class='errorMssg'>"+a+"</div>")},$.fn.validateField=function(a,b){alert('If you see this alert, please contact Soren with the following message: "Tombstone 010 found"');var c=!0,d=$(this).val();return $(this).validationAction(c),d?d.length>=a&&d.length<=b||(c=!1):c=!1,$(this).validationAction(c),c},$.fn.validateNumericField=function(a,b){alert('If you see this alert, please contact Soren with the following message: "Tombstone 011 found"');var c=!0,d=$(this).val();return $(this).validationAction(c),d&&$.isNumeric(d)?a&&b&&(d>=a&&b>=d||(c=!1)):c=!1,$(this).validationAction(c),c},$.fn.validationAction=function(a){alert('If you see this alert, please contact Soren with the following message: "Tombstone 012 found"'),a===!0?$(this).css("border-color",""):$(this).css("border-color","red")};var Accommodation={get:function(a,b){$.get("/api/accommodation",a,b)},getAll:function(a){$.get("/api/accommodation/all",a)},getAllWithTrashed:function(a){$.get("/api/accommodation/all-with-trashed",a)},create:function(a,b,c){$.ajax({type:"POST",url:"/api/accommodation/add",data:a,success:b,error:c})},update:function(a,b,c){$.ajax({type:"POST",url:"/api/accommodation/edit",data:a,success:b,error:c})},"delete":function(a,b,c){$.ajax({type:"POST",url:"/api/accommodation/delete",data:a,success:b,error:c})},filter:function(a,b,c){$.ajax({type:"GET",url:"/api/accommodation/filter",data:a,success:b,error:c})}},Addon={getAddon:function(a,b){$.get("/api/addon",a,function(a){b(a)})},getAllAddons:function(a){$.get("/api/addon/all",function(b){a(b)})},createAddon:function(a,b,c){$.ajax({type:"POST",url:"/api/addon/add",data:a,success:b,error:c})},updateAddon:function(a,b,c){$.ajax({type:"POST",url:"/api/addon/edit",data:a,success:b,error:c})},deleteAddon:function(a,b,c){$.ajax({type:"POST",url:"/api/addon/delete",data:a,success:b,error:c})}},Agency={getAll:function(a){$.get("/api/agency/all",function(b){a(b)})}},Agent={getAgent:function(a,b){$.get("/api/agent",a,function(a){b(a)})},getAllAgents:function(a){$.get("/api/agent/all",function(b){a(b)})},createAgent:function(a,b,c){$.ajax({type:"POST",url:"/api/agent/add",data:a,success:b,error:c})},updateAgent:function(a,b,c){$.ajax({type:"POST",url:"/api/agent/edit",data:a,success:b,error:c})}},Boat={get:function(a,b){$.get("/api/boat",a,b)},getAll:function(a){$.get("/api/boat/all",a)},getAllWithTrashed:function(a){$.get("/api/boat/all-with-trashed",a)},create:function(a,b,c){$.ajax({type:"POST",url:"/api/boat/add",data:a,success:b,error:c})},update:function(a,b,c){$.ajax({type:"POST",url:"/api/boat/edit",data:a,success:b,error:c})},"delete":function(a,b,c){$.ajax({type:"POST",url:"/api/boat/delete",data:a,success:b,error:c})}},Boatroom={get:function(a,b){$.get("/api/boatroom",a,b)},getAll:function(a){$.get("/api/boatroom/all",a)},create:function(a,b,c){$.ajax({type:"POST",url:"/api/boatroom/add",data:a,success:b,error:c})},update:function(a,b,c){$.ajax({type:"POST",url:"/api/boatroom/edit",data:a,success:b,error:c})},"delete":function(a,b,c){$.ajax({type:"POST",url:"/api/boatroom/delete",data:a,success:b,error:c})}},Booking=function(a){this.decimal_price="0.00",this.discount="0.00",this.lead_customer=!1,this.bookingdetails=[],this.accommodations=[],this.payments=[],this.refunds=[],this.currentTab=null,this.selectedTickets={},this.selectedPackages={},this.selectedCourses={},this.selectedCustomers={},this.sums={},void 0!==a&&($.extend(this,a),this.setStatus()),this.calculateSums()};Booking.get=function(a,b){$.get("/api/booking",{id:a},function(a){b(new Booking(a))})},Booking.getAll=function(a){$.get("/api/booking/all",a)},Booking.getRecent=function(a,b){$.ajax({type:"GET",url:"/api/booking/all/0/5",success:a,error:b})},Booking.today=function(a,b){$.ajax({type:"GET",url:"/api/booking/today",success:a,error:b})},Booking.tomorrow=function(a,b){$.ajax({type:"GET",url:"/api/booking/tomorrow",success:a,error:b})},Booking.filter=function(a,b,c){$.ajax({type:"GET",url:"/api/booking/filter",data:a,success:b,error:c})},Booking.getCustomerBookings=function(a,b,c){$.ajax({type:"GET",url:"/api/booking/customerbookings",data:a,success:b,error:c})},Booking.pickUpLocations=function(a,b){$.get("/api/booking/pick-up-locations",a,b)},Booking.initiateStorage=function(){window.basil=new window.Basil({namespace:"bookings",storages:["local","cookie"]})},Booking.cancel=function(a,b,c){$.ajax({type:"POST",url:"/api/booking/cancel",data:a,context:this,success:function(a){b(a.status)},error:c})},Booking.prototype.store=function(){return"undefined"==typeof window.basil&&Booking.initiateStorage(),window.basil.set("booking_"+this.id,{selectedTickets:this.selectedTickets,selectedCustomers:this.selectedCustomers,selectedPackages:this.selectedPackages,selectedCourses:this.selectedCourses,currentTab:this.currentTab}),!0},Booking.prototype.loadStorage=function(){"undefined"==typeof window.basil&&Booking.initiateStorage();var a=window.basil.get("booking_"+this.id);null!==a&&(this.selectedTickets=a.selectedTickets,this.selectedCustomers=a.selectedCustomers,this.selectedPackages=a.selectedPackages,this.selectedCourses=a.selectedCourses,this.currentTab=a.currentTab)},Booking.prototype.initiate=function(a,b,c){$.ajax({type:"POST",url:"/api/booking/init",data:a,context:this,success:function(c){this.id=c.id,this.reference=c.reference,this.source=a.source||null,this.agent_id=a.agent_id||null,this.agent_reference=a.agent_reference||null,b(c.status)},error:c})},Booking.prototype.addDetail=function(a,b,c){a.booking_id=this.id,"undefined"==typeof a.packagefacade_id&&"undefined"!=typeof a.package_id&&console.warn("WARNING: Potentially unexpected behaviour! - No packagefacade_id submitted. A new package will be assigned."),$.ajax({type:"POST",url:"/api/booking/add-detail",data:a,context:this,success:function(c){var d={id:c.id,customer:window.customers[a.customer_id],session:a.session_id?window.sessions[a.session_id]:null,ticket:a.ticket_id?$.extend(!0,{},window.tickets[a.ticket_id]):null,course:a.course_id?$.extend(!0,{},window.courses[a.course_id]):null,training_session:a.training_session_id?window.training_sessions[a.training_session_id]:null,addons:[]};a.package_id?(d.packagefacade={id:c.packagefacade_id,"package":$.extend(!0,{},window.packages[a.package_id])},d.packagefacade["package"].decimal_price=c.package_decimal_price):a.course_id?d.course.decimal_price=c.course_decimal_price:d.ticket.decimal_price=c.ticket_decimal_price,c.boatroom_id&&(d.boatroom_id=c.boatroom_id),_.each(c.addons,function(a){var b=$.extend(!0,{},window.addons[a]);b.pivot={quantity:1},d.addons.push(b)}),this.bookingdetails.push(d),this.lead_customer||1!==this.bookingdetails.count||(this.lead_customer=window.customers[a.customer_id]),this.decimal_price=c.decimal_price,this.calculateSums(),b(c.status,c.packagefacade_id)},error:c})},Booking.prototype.removeDetail=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/remove-detail",data:a,context:this,success:function(c){var d=_.find(this.bookingdetails,function(b){return b.id==a.bookingdetail_id});this.bookingdetails=_.reject(this.bookingdetails,function(b){return b.id==a.bookingdetail_id}),this.decimal_price=c.decimal_price,this.calculateSums(),b(c.status,d)},error:c})},Booking.prototype.setLead=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/set-lead",data:a,context:this,success:function(c){null===a.customer_id?this.lead_customer=!1:this.lead_customer=window.customers[a.customer_id],b(c.status)},error:c})},Booking.prototype.addAddon=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/add-addon",data:a,context:this,success:function(c){var d=_.find(this.bookingdetails,function(b){return b.id==a.bookingdetail_id}),e=_.find(d.addons,function(b){return b.id==a.addon_id&&b.pivot.packagefacade_id==(a.packagefacade_id||null)});if(void 0!==e)e.pivot.quantity+=parseInt(a.quantity);else{var f=$.extend(!0,{},window.addons[a.addon_id]);f.pivot={quantity:parseInt(a.quantity),packagefacade_id:a.packagefacade_id?a.packagefacade_id:null},d.addons.push(f)}this.decimal_price=c.decimal_price,a.packagefacade_id||this.calculateSums(),b(c.status)},error:c})},Booking.prototype.removeAddon=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/remove-addon",data:a,context:this,success:function(c){var d=_.find(this.bookingdetails,function(b){return b.id==a.bookingdetail_id}),e=_.find(d.addons,function(b){return b.id==a.addon_id&&b.pivot.packagefacade_id==(a.packagefacade_id||null)});e.pivot.quantity>1?e.pivot.quantity--:d.addons=_.reject(d.addons,function(b){return b.id==a.addon_id&&b.pivot.packagefacade_id==(a.packagefacade_id||null)}),this.decimal_price=c.decimal_price,null===e.pivot.packagefacade_id&&this.calculateSums(),b(c.status,e)},error:c})},Booking.prototype.addAccommodation=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/add-accommodation",data:a,context:this,success:function(c){var d=$.extend(!0,{},window.accommodations[a.accommodation_id]);d.pivot={start:a.start,end:a.end,customer_id:a.customer_id,packagefacade_id:c.packagefacade_id?c.packagefacade_id:null},d.customer=window.customers[a.customer_id],d.decimal_price=c.accommodation_decimal_price,this.accommodations.push(d),this.decimal_price=c.decimal_price,a.packagefacade_id||this.calculateSums(),b(c.status,c.packagefacade_id)},error:c})},Booking.prototype.removeAccommodation=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/remove-accommodation",data:a,context:this,success:function(c){var d=_.find(this.accommodations,function(b){return b.id==a.accommodation_id&&b.pivot.customer_id==a.customer_id&&b.pivot.start===a.start});this.accommodations=_.reject(this.accommodations,function(b){return b.id==a.accommodation_id&&b.pivot.customer_id==a.customer_id&&b.pivot.start===a.start}),this.decimal_price=c.decimal_price,null===d.pivot.packagefacade_id&&this.calculateSums(),b(c.status,d)},error:c})},Booking.prototype.editInfo=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/edit-info",data:a,context:this,success:function(c){a.pick_up_location&&(this.pick_up_location=a.pick_up_location),
a.pick_up_time&&(this.pick_up_time=a.pick_up_time),a.discount&&(this.discount=a.discount),a.comment&&(this.comment=a.comment),this.decimal_price=c.decimal_price,this.calculateSums(),b(c.status)},error:c})},Booking.prototype.reserve=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/reserve",data:a,context:this,success:function(c){this.reserved=a.reserved,this.status="reserved",b(c.status)},error:c})},Booking.prototype.save=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/save",data:a,context:this,success:function(a){this.status="saved",this.setStatus(),b(a.status)},error:c})},Booking.prototype.confirm=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/confirm",data:a,context:this,success:function(a){this.status="confirmed",this.setStatus(),b(a.status)},error:c})},Booking.prototype.cancel=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/booking/cancel",data:a,context:this,success:function(c){this.status="cancelled",this.setStatus(),this.cancellation_fee=a.cancellation_fee,this.calculateSums(),b(c.status)},error:c})},Booking.prototype.addPayment=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/payment/add",data:a,context:this,success:function(a){var c=a.payment;c.paymentgateway=window.paymentgateways[c.paymentgateway_id],this.payments.push(c),this.status="confirmed",this.setStatus(),this.calculateSums(),b(a.status)},error:c})},Booking.prototype.loadPayments=function(a,b){var c={booking_id:this.id};$.ajax({type:"POST",url:"/api/booking/payments",data:c,context:this,success:function(b){this.payments=b,a(b.status)},error:b})},Booking.prototype.addRefund=function(a,b,c){a.booking_id=this.id,$.ajax({type:"POST",url:"/api/refund/add",data:a,context:this,success:function(a){var c=a.refund;c.paymentgateway=window.paymentgateways[c.paymentgateway_id],this.refunds.push(c),this.calculateSums(),b(a.status)},error:c})},Booking.prototype.loadRefunds=function(a,b){var c={booking_id:this.id};$.ajax({type:"POST",url:"/api/booking/refunds",data:c,context:this,success:function(b){this.refunds=b,a(b.status)},error:b})},Booking.prototype.validate=function(a,b){var c={booking_id:this.id};$.ajax({type:"GET",url:"/api/booking/validate",data:c,context:this,success:function(b){a(b.status)},error:b})},Booking.prototype.calculateSums=function(){this.sums.payed=_.reduce(this.payments,function(a,b){return a+1*b.amount},0).toFixed(2),this.sums.refunded=_.reduce(this.refunds,function(a,b){return a+1*b.amount},0).toFixed(2),this.sums.have=(this.sums.payed-this.sums.refunded).toFixed(2),this.sums.payable=(this.decimal_price-this.sums.have).toFixed(2),this.sums.refundable=(this.sums.have-this.cancellation_fee).toFixed(2)},Booking.prototype.setStatus=function(){switch(this.saved=this.reserved=this.confirmed=this.cancelled=!1,this.status){case"saved":this.saved=!0;break;case"reserved":this.reserved=!0;break;case"confirmed":this.confirmed=!0;break;case"cancelled":this.cancelled=!0}};var Class={get:function(a,b){$.get("/api/class",a,function(a){b(a)})},getAll:function(a){$.get("/api/class/all",function(b){a(b)})},create:function(a,b,c){$.ajax({type:"POST",url:"/api/class/add",data:a,success:b,error:c})},update:function(a,b,c){$.ajax({type:"POST",url:"/api/class/edit",data:a,success:b,error:c})},"delete":function(a,b,c){$.ajax({type:"POST",url:"/api/class/delete",data:a,success:b,error:c})},getAllSessions:function(a,b){$.get("/api/class-session/all",a,function(a){b(a)})},filter:function(a,b,c){$.ajax({type:"GET",url:"/api/class-session/filter",data:a,success:b,error:c})},createSession:function(a,b,c){$.ajax({type:"POST",url:"/api/class-session/add",data:a,success:b,error:c})},updateSession:function(a,b,c){$.ajax({type:"POST",url:"/api/class-session/edit",data:a,success:b,error:c})},deleteSession:function(a,b,c){$.ajax({type:"POST",url:"/api/class-session/delete",data:a,success:b,error:c})},deactivateSession:function(a,b){$.post("/api/class-session/deactivate",a,function(a){b(a)})},restoreSession:function(a,b){$.post("/api/class-session/restore",a,function(a){b(a)})},getAllCustomers:function(a,b,c){$.ajax({type:"GET",url:"/api/class-session/manifest",data:a,success:b,error:c})}},Company={getCompany:function(a){$.ajax({type:"GET",async:!1,url:"/api/company",success:a})},update:function(a,b,c){$.ajax({url:"/api/company/update",type:"POST",data:a,success:b,error:c})},initialise:function(a,b,c){$.ajax({type:"POST",url:"/api/company/initialise",data:a,success:b,error:c})},getNotifications:function(a){$.get("/api/company/notifications",function(b){a(b)})},sendFeedback:function(a,b,c){$.ajax({type:"POST",url:"/api/company/feedback",data:a,success:b,error:c})},sendEmail:function(a,b,c){$.ajax({type:"POST",url:"/api/company/email",data:a,success:b,error:c})},sendHeartbeat:function(a){a=$.extend({},a,{route:window.location.hash,_token:window.token}),$.ajax({type:"POST",url:"/api/company/heartbeat",data:a,global:!1})}},Course={get:function(a,b){$.get("/api/course",a,function(a){b(a)})},getAll:function(a){$.get("/api/course/all",function(b){a(b)})},create:function(a,b,c){$.ajax({type:"POST",url:"/api/course/add",data:a,success:b,error:c})},update:function(a,b,c){$.ajax({type:"POST",url:"/api/course/edit",data:a,success:b,error:c})},"delete":function(a,b,c){$.ajax({type:"POST",url:"/api/course/delete",data:a,success:b,error:c})}},Customer={getCustomer:function(a,b){$.get("/api/customer",a,function(a){b(a)})},getAllCustomers:function(a){$.get("/api/customer/all",function(b){a(b)})},createCustomer:function(a,b,c){$.ajax({type:"POST",url:"/api/customer/add",data:a,success:b,error:c})},filter:function(a,b,c){$.ajax({type:"GET",url:"/api/customer/filter",data:a,success:b,error:c})},updateCustomer:function(a,b,c){$.ajax({type:"POST",url:"/api/customer/edit",data:a,success:b,error:c})}},Place={around:function(a,b){$.get("/api/company/locations",a).done(function(a){b(a)})},inside:function(a,b){$.get("/api/company/locations",a).done(function(a){b(a)})},tags:function(a){$.get("/api/location/tags",a)},create:function(a,b,c){$.ajax({type:"POST",url:"/api/company/add-location",data:a,success:b,error:c})},update:function(a,b,c){$.ajax({type:"POST",url:"/api/location/update",data:a,success:b,error:c})},attached:function(a){$.get("/api/location/all").done(function(b){a(b)})},attach:function(a,b){$.post("/api/location/attach",a).done(function(a){b(a)})},detach:function(a,b,c){$.ajax({type:"POST",url:"/api/location/detach",data:a,success:b,error:c})}},Package={getPackage:function(a,b){$.get("/api/package",a,function(a){b(a)})},getAllPackages:function(a){$.get("/api/package/all",function(b){a(b)})},getAllWithTrashed:function(a){$.get("/api/package/all-with-trashed",function(b){a(b)})},getOnlyAvailable:function(a){$.get("/api/package/only-available",function(b){a(b)})},createPackage:function(a,b,c){$.ajax({type:"POST",url:"/api/package/add",data:a,success:b,error:c})},updatePackage:function(a,b,c){$.ajax({type:"POST",url:"/api/package/edit",data:a,success:b,error:c})},deletePackage:function(a,b,c){$.ajax({type:"POST",url:"/api/package/delete",data:a,success:b,error:c})}},Payment={get:function(a,b){$.get("/api/payment",a,b)},getAll:function(a,b,c){void 0===b&&(b=""),c=void 0===c?"":"/"+c,$.get("/api/payment/all"+b+c,a)},getAllPaymentgateways:function(a){$.get("/api/payment/paymentgateways",a)}},Refund={get:function(a,b){$.get("/api/refund",a,b)},getAll:function(a,b,c){void 0===b&&(b=""),c=void 0===c?"":"/"+c,$.get("/api/refund/all"+b+c,a)},getAllPaymentgateways:function(a){$.get("/api/refund/paymentgateways",a)}},Report={getPaymentGateways:function(a){$.ajax({url:"/api/payment/paymentgateways",success:a})},getPayments:function(a,b){$.ajax({url:"/api/payment/filter",data:a,success:b})},getRefunds:function(a,b){$.ajax({url:"/api/refund/filter",data:a,success:b})},getAgentBookings:function(a,b){$.ajax({url:"/api/booking/filter-confirmed-by-agent",data:a,success:b})},getBookingHistory:function(a,b){$.ajax({url:"/api/booking/filter-confirmed",data:a,success:b})},getTripUtilisation:function(a,b){$.ajax({url:"/api/report/utilisation",data:a,success:b})},getClassUtilisation:function(a,b){$.ajax({url:"/api/report/trainingutilisation",data:a,success:b})},getDemographics:function(a,b){$.ajax({url:"/api/report/demographics",data:a,success:b})},getPickupSchedule:function(a,b){$.ajax({url:"api/company/pick-up-schedule",data:a,success:b})},getTicketsPackages:function(a,b){$.ajax({url:"api/report/revenue-streams",data:a,success:b})}},Session={getSpecificSession:function(a,b){$.get("/api/session",a).done(function(a){b(a)})},getAllSessions:function(a){console.warning("The function Session.getAllSessions() has been deprecated! Please use Session.filter() instead!"),$.get("/api/session/all").done(function(b){a(b)})},filter:function(a,b,c){$.ajax({type:"GET",url:"/api/session/filter",data:a,success:b,error:c})},getToday:function(a,b){$.ajax({type:"GET",url:"/api/session/today",success:a,error:b})},createSession:function(a,b,c){$.ajax({type:"POST",url:"/api/session/add",data:a,success:b,error:c})},updateSession:function(a,b,c){$.ajax({type:"POST",url:"/api/session/edit",data:a,success:b,error:c})},deleteSession:function(a,b,c){$.ajax({type:"POST",url:"/api/session/delete",data:a,success:b,error:c})},deactivateSession:function(a,b){$.post("/api/session/deactivate",a,function(a){b(a)})},restoreSession:function(a,b){$.post("/api/session/restore",a,function(a){b(a)})},getAllCustomers:function(a,b,c){$.ajax({type:"GET",url:"/api/session/manifest",data:a,success:b,error:c})}},Ticket={getTicket:function(a,b){$.get("/api/ticket",a,function(a){b(a)})},getAllTickets:function(a){$.get("/api/ticket/all",function(b){a(b)})},getAllWithTrashed:function(a){$.get("/api/ticket/all-with-trashed",function(b){a(b)})},getOnlyAvailable:function(a){$.get("/api/ticket/only-available",function(b){a(b)})},createTicket:function(a,b,c){$.ajax({type:"POST",url:"/api/ticket/add",data:a,success:b,error:c})},updateTicket:function(a,b,c){$.ajax({type:"POST",url:"/api/ticket/edit",data:a,success:b,error:c})},deleteTicket:function(a,b){$.post("/api/ticket/delete",a,function(a){b(a)})}},Timetable={createTimetable:function(a,b,c){$.ajax({type:"POST",url:"/api/timetable/add",data:a,success:b,error:c})},createClassTimetable:function(a,b,c){$.ajax({type:"POST",url:"/api/schedule/add",data:a,success:b,error:c})}},Trip={getAllTrips:function(a){$.get("/api/trip/all").done(function(b){a(b)})},getAllWithTrashed:function(a){$.get("/api/trip/all-with-trashed").done(function(b){a(b)})},getSpecificTrip:function(a,b){$.get("/api/trip",a).done(function(a){b(a)})},tags:function(a){$.get("/api/trip/tags",a)},create:function(a,b,c){$.ajax({type:"POST",url:"/api/trip/add",data:a,success:b,error:c})},update:function(a,b,c){$.ajax({type:"POST",url:"/api/trip/edit",data:a,success:b,error:c})},"delete":function(a,b,c){$.ajax({type:"POST",url:"/api/trip/delete",data:a,success:b,error:c})}};